{% extends "layout.html" %}

{% block content %}
<div id="c2-root">
  <header class="topbar">
    <div class="status-pill">
      <div class="pill-brand">
        <span class="pill-title">C2 Walaris</span>
      </div>
      <div class="pill-menu-group">
        <div class="pill-menu" data-menu="tray">
          <button class="pill-menu-trigger" type="button" aria-expanded="false">
            Operating System Tray
            <span class="pill-menu-caret" aria-hidden="true">▾</span>
          </button>
          <div class="pill-menu-panel" role="menu" aria-label="Operating System Tray">
            <button class="pill-menu-item" type="button" data-window-action="toggle" data-window-id="dock-left">
              Operations Menu
              <span class="pill-menu-state" data-window-state="dock-left">Minimized</span>
            </button>
            <button class="pill-menu-item" type="button" data-window-action="toggle" data-window-id="dock-right">
              Inspector Panel
              <span class="pill-menu-state" data-window-state="dock-right">Minimized</span>
            </button>
          </div>
        </div>
        <div class="pill-menu" data-menu="windows">
          <button class="pill-menu-trigger" type="button" aria-expanded="false">
            Window Manager
            <span class="pill-menu-caret" aria-hidden="true">▾</span>
          </button>
          <div class="pill-menu-panel" role="menu" aria-label="Window Manager">
            <button class="pill-menu-item" type="button" data-window-action="open-all">Open all windows</button>
            <button class="pill-menu-item" type="button" data-window-action="minimize-all">Minimize all windows</button>
            <button class="pill-menu-item" type="button" data-window-action="close-all">Close all windows</button>
          </div>
        </div>
      </div>
      <div class="pill-status">
        <span class="status-dot" id="api-dot"></span>
        <span id="api-status">API: booting</span>
        <span class="status-sep">|</span>
        <span id="stream-status">SSE: offline</span>
        <span class="status-sep">|</span>
        <span id="ws-status">WS: offline</span>
        <span class="status-sep">|</span>
        <span id="runtime-stats">Entities: 0 · FPS: --</span>
        <span class="status-sep">|</span>
        <span id="camera-stats">View: Globe · Dist: --</span>
        <span class="status-sep">|</span>
        <span id="tile-status">Tiles: --</span>
        <span class="status-sep">|</span>
        {{ service_name }} · {{ environment | upper }}
      </div>
    </div>
  </header>

  <div class="c2-body">
    <aside class="dock window" id="dock-left" data-state="closed" data-window-title="Operations Menu">
      <div class="dock-panel">
        <div class="dock-header">
          <div class="dock-title">Operations Menu</div>
          <div class="dock-controls">
            <button class="dock-control dock-move" type="button" data-dock-drag-handle="true" aria-label="Move operations menu">⠿</button>
            <button class="dock-control" type="button" data-dock-action="minimize" aria-label="Minimize operations menu">—</button>
            <button class="dock-control" type="button" data-dock-action="close" aria-label="Close operations menu">×</button>
          </div>
        </div>
        <div class="dock-content">
          <section class="panel-section" data-collapsible="true" data-collapsed="false">
            <button class="panel-header" type="button" aria-expanded="true">
              <span class="panel-title">Live Mission Feed</span>
              <span class="panel-toggle-icon" aria-hidden="true">-</span>
            </button>
            <div class="panel-body">
              <div id="mission-feed-panel" data-partial="/partials/mission-feed">
                {% include "partials/mission_feed.html" %}
              </div>
            </div>
          </section>
          <section class="panel-section" data-collapsible="true" data-collapsed="false">
            <button class="panel-header" type="button" aria-expanded="true">
              <span class="panel-title">Priority Incidents</span>
              <span class="panel-toggle-icon" aria-hidden="true">-</span>
            </button>
            <div class="panel-body">
              <div id="incident-panel" data-partial="/partials/incidents">
                {% include "partials/incidents.html" %}
              </div>
            </div>
          </section>
          <section class="panel-section" data-collapsible="true" data-collapsed="false">
            <button class="panel-header" type="button" aria-expanded="true">
              <span class="panel-title">Asset Readiness</span>
              <span class="panel-toggle-icon" aria-hidden="true">-</span>
            </button>
            <div class="panel-body">
              <div id="asset-panel" data-partial="/partials/assets">
                {% include "partials/assets.html" %}
              </div>
            </div>
          </section>
          <section class="panel-section" data-collapsible="true" data-collapsed="false">
            <button class="panel-header" type="button" aria-expanded="true">
              <span class="panel-title">Globe Layers</span>
              <span class="panel-toggle-icon" aria-hidden="true">-</span>
            </button>
            <div class="panel-body">
              <div class="panel-field">
                <label for="tile-provider">Tile provider</label>
                <select id="tile-provider"></select>
              </div>
              <div class="panel-actions">
                <button data-globe-mode="day" data-active="true">Day</button>
                <button data-globe-mode="night">Night</button>
                <button data-globe-toggle="axes" aria-pressed="true">Axes</button>
                <button data-globe-toggle="grid" aria-pressed="true">Grid</button>
              </div>
              <div class="meta">Toggle globe lighting and debug layers.</div>
            </div>
          </section>
          <section class="panel-section" id="weather-panel" data-collapsible="true" data-collapsed="false">
            <button class="panel-header" type="button" aria-expanded="true">
              <span class="panel-title">Weather Overlay</span>
              <span class="panel-toggle-icon" aria-hidden="true">-</span>
            </button>
            <div class="panel-body">
              <div class="panel-field">
                <label for="weather-field">Data layer</label>
                <select id="weather-field"></select>
              </div>
              <div class="panel-actions">
                <button data-weather-toggle="overlay" aria-pressed="false">Weather</button>
              </div>
              <div class="meta">NASA GIBS tiles layered above base maps.</div>
            </div>
          </section>
          <section class="panel-section" id="flight-panel" data-collapsible="true" data-collapsed="false">
            <button class="panel-header" type="button" aria-expanded="true">
              <span class="panel-title">Air Traffic</span>
              <span class="panel-toggle-icon" aria-hidden="true">-</span>
            </button>
            <div class="panel-body">
              <div class="panel-actions">
                <button data-flight-toggle="overlay" aria-pressed="false">Flights</button>
              </div>
              <div class="meta" id="flight-provider-label">Live flight tracks via OpenSky.</div>
            </div>
          </section>
          <section class="panel-section" id="satellite-panel" data-collapsible="true" data-collapsed="false">
            <button class="panel-header" type="button" aria-expanded="true">
              <span class="panel-title">Satellites</span>
              <span class="panel-toggle-icon" aria-hidden="true">-</span>
            </button>
            <div class="panel-body">
              <div class="panel-actions">
                <button data-satellite-toggle="overlay" aria-pressed="false">Satellites</button>
              </div>
              <div class="meta" id="satellite-provider-label">Live satellite tracks via CelesTrak.</div>
            </div>
          </section>
          <section class="panel-section" id="ship-panel" data-collapsible="true" data-collapsed="false">
            <button class="panel-header" type="button" aria-expanded="true">
              <span class="panel-title">Maritime</span>
              <span class="panel-toggle-icon" aria-hidden="true">-</span>
            </button>
            <div class="panel-body">
              <div class="panel-actions">
                <button data-ship-toggle="overlay" aria-pressed="false">Ships</button>
              </div>
              <div class="meta" id="ship-provider-label">Live vessel tracks via ArcGIS.</div>
            </div>
          </section>
          <section class="panel-section" id="media-overlay-panel" data-collapsible="true" data-collapsed="true">
            <button class="panel-header" type="button" aria-expanded="false">
              <span class="panel-title">Media Overlay</span>
              <span class="panel-toggle-icon" aria-hidden="true">+</span>
            </button>
            <div class="panel-body">
              <div class="panel-actions">
                <button data-media-overlay-toggle="overlay" aria-pressed="false">Overlay</button>
              </div>
              <div class="panel-field">
                <label for="media-overlay-type">Source type</label>
                <select id="media-overlay-type">
                  <option value="mjpg">MJPG stream</option>
                  <option value="rtsp">RTSP stream</option>
                  <option value="video">Video (mp4/hls)</option>
                  <option value="gif">Animated GIF</option>
                  <option value="image">Static image</option>
                </select>
              </div>
              <div class="panel-field">
                <label for="media-overlay-url">Source URL</label>
                <input
                  id="media-overlay-url"
                  type="text"
                  placeholder="rtsp://, http(s)://.../stream.mjpg, https://.../video.mp4"
                />
              </div>
              <div class="panel-actions">
                <button type="button" data-media-overlay-load>Load</button>
                <button type="button" data-media-overlay-clear>Clear</button>
              </div>
              <div class="panel-field">
                <label for="media-overlay-lat">Latitude</label>
                <input id="media-overlay-lat" type="number" step="0.1" value="0" />
              </div>
              <div class="panel-field">
                <label for="media-overlay-lon">Longitude</label>
                <input id="media-overlay-lon" type="number" step="0.1" value="0" />
              </div>
              <div class="panel-field">
                <label for="media-overlay-width">Width (deg)</label>
                <input id="media-overlay-width" type="number" step="0.5" value="16" />
              </div>
              <div class="panel-field">
                <label for="media-overlay-height">Height (deg)</label>
                <input id="media-overlay-height" type="number" step="0.5" value="9" />
              </div>
              <div class="panel-field">
                <label for="media-overlay-rotation">Rotation (deg)</label>
                <input id="media-overlay-rotation" type="number" step="1" value="0" />
              </div>
              <div class="panel-field">
                <label for="media-overlay-altitude">Altitude</label>
                <input id="media-overlay-altitude" type="number" step="0.05" value="0.45" />
              </div>
              <div class="panel-field">
                <label for="media-overlay-scale">Scale</label>
                <input id="media-overlay-scale" type="number" step="0.05" value="1" />
              </div>
              <div class="meta">Curved media sheet mapped to the globe surface.</div>
            </div>
          </section>
          <section class="panel-section" data-collapsible="true" data-collapsed="false">
            <button class="panel-header" type="button" aria-expanded="true">
              <span class="panel-title">Overlays</span>
              <span class="panel-toggle-icon" aria-hidden="true">-</span>
            </button>
            <div class="panel-body">
              <div class="panel-actions">
                <button data-layer-toggle="pins">Pins</button>
              </div>
              <div class="meta">Toggle overlays anchored to tracked entities.</div>
            </div>
          </section>
        </div>
      </div>
    </aside>

    <main class="board" id="board">
      <div class="layer-stack" id="layer-stack">
        <canvas id="map-3d" data-layer="map-3d"></canvas>
        <canvas id="map-2d" data-layer="map-2d"></canvas>
        <div class="dom-layer" id="pin-layer" data-layer="pins"></div>
        <div class="dom-layer flight-layer" id="flight-layer" data-layer="flights"></div>
        <div class="dom-layer satellite-layer" id="satellite-layer" data-layer="satellites"></div>
        <div class="dom-layer ship-layer" id="ship-layer" data-layer="ships"></div>
        <div class="edge-layer" id="edge-layer" data-layer="edges"></div>
      </div>
      <div class="crosshair" id="crosshair" aria-hidden="true"></div>
    </main>

    <aside class="dock window" id="dock-right" data-state="closed" data-window-title="Inspector Panel">
      <div class="dock-panel">
        <div class="dock-header">
          <div class="dock-title">Inspector Panel</div>
          <div class="dock-controls">
            <button class="dock-control dock-move" type="button" data-dock-drag-handle="true" aria-label="Move inspector panel">⠿</button>
            <button class="dock-control" type="button" data-dock-action="minimize" aria-label="Minimize inspector panel">—</button>
            <button class="dock-control" type="button" data-dock-action="close" aria-label="Close inspector panel">×</button>
          </div>
        </div>
        <div class="dock-content">
          <section class="panel-section">
            <h2>Inspector</h2>
            <p class="meta">Select an entity to view assignments, posture, and comms.</p>
          </section>
          <section class="panel-section">
            <h2>Alerts</h2>
            <p class="meta">Escalations and warnings appear here.</p>
          </section>
          <section class="panel-section">
            <h2>Overlays</h2>
            <p class="meta">Toggle overlays tied to missions, units, and tasks.</p>
          </section>
        </div>
      </div>
    </aside>
  </div>

</div>
{% endblock content %}
